{
  "dashboard": {
    "title": "Agent Operations",
    "uid": "enterprise-agent-operations",
    "version": 1,
    "timezone": "browser",
    "editable": true,
    "graphTooltip": 1,
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "refresh": "30s",
    "tags": ["agents", "operations"],
    "templating": {
      "list": [
        {
          "name": "tenant_id",
          "type": "query",
          "label": "Tenant",
          "query": "label_values(agent_run_duration_seconds_count, tenant_id)",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "allValue": ".*",
          "includeAll": true,
          "multi": false,
          "refresh": 2
        },
        {
          "name": "agent_type",
          "type": "query",
          "label": "Agent Type",
          "query": "label_values(agent_run_duration_seconds_count, agent_type)",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "allValue": ".*",
          "includeAll": true,
          "multi": true,
          "refresh": 2
        }
      ]
    },
    "panels": [
      {
        "id": 1,
        "title": "Active Agent Runs",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "sum(active_agent_runs{tenant_id=~\"$tenant_id\"})",
            "legendFormat": "Active Runs",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 20},
                {"color": "red", "value": 50}
              ]
            }
          }
        },
        "options": {
          "reduceOptions": {"calcs": ["lastNotNull"]},
          "colorMode": "background",
          "graphMode": "area"
        }
      },
      {
        "id": 2,
        "title": "Agent Run Rate (runs/s)",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "sum(rate(agent_run_duration_seconds_count{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[5m]))",
            "legendFormat": "Runs/s",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {"unit": "reqps"}
        },
        "options": {
          "reduceOptions": {"calcs": ["lastNotNull"]},
          "colorMode": "value",
          "graphMode": "area"
        }
      },
      {
        "id": 3,
        "title": "Agent Success Rate (%)",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "100 * (sum(rate(agent_run_duration_seconds_count{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\",status=\"success\"}[5m])) / sum(rate(agent_run_duration_seconds_count{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[5m])))",
            "legendFormat": "Success %",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "yellow", "value": 90},
                {"color": "green", "value": 99}
              ]
            }
          }
        },
        "options": {
          "reduceOptions": {"calcs": ["lastNotNull"]},
          "colorMode": "background",
          "graphMode": "none"
        }
      },
      {
        "id": 4,
        "title": "Total Steps Executed (1 h)",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "sum(increase(agent_steps_total{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[1h]))",
            "legendFormat": "Steps",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {"unit": "short"}
        },
        "options": {
          "reduceOptions": {"calcs": ["lastNotNull"]},
          "colorMode": "value",
          "graphMode": "area"
        }
      },
      {
        "id": 5,
        "title": "Active Agent Runs Over Time",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "sum by (agent_type) (active_agent_runs{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"})",
            "legendFormat": "{{agent_type}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "custom": {"lineWidth": 2, "fillOpacity": 20}
          }
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {"displayMode": "table", "placement": "bottom"}
        }
      },
      {
        "id": 6,
        "title": "Agent Execution Rate by Type (runs/s)",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "sum by (agent_type, status) (rate(agent_run_duration_seconds_count{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[5m]))",
            "legendFormat": "{{agent_type}} — {{status}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "reqps",
            "custom": {"lineWidth": 2, "fillOpacity": 10}
          }
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {"displayMode": "table", "placement": "bottom"}
        }
      },
      {
        "id": 7,
        "title": "Agent Execution Latency — P50 / P95 / P99",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 12},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "histogram_quantile(0.50, sum by (le, agent_type) (rate(agent_run_duration_seconds_bucket{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[5m])))",
            "legendFormat": "P50 {{agent_type}}",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.95, sum by (le, agent_type) (rate(agent_run_duration_seconds_bucket{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[5m])))",
            "legendFormat": "P95 {{agent_type}}",
            "refId": "B"
          },
          {
            "expr": "histogram_quantile(0.99, sum by (le, agent_type) (rate(agent_run_duration_seconds_bucket{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[5m])))",
            "legendFormat": "P99 {{agent_type}}",
            "refId": "C"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {"lineWidth": 2, "fillOpacity": 5}
          }
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max", "lastNotNull"]}
        }
      },
      {
        "id": 8,
        "title": "Agent Steps Rate (steps/s)",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 20},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "sum by (agent_type) (rate(agent_steps_total{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[5m]))",
            "legendFormat": "{{agent_type}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "custom": {"lineWidth": 2, "fillOpacity": 10}
          }
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {"displayMode": "table", "placement": "bottom"}
        }
      },
      {
        "id": 9,
        "title": "Average Steps per Agent Run",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 20},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "sum by (agent_type) (rate(agent_steps_total{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[5m])) / sum by (agent_type) (rate(agent_run_duration_seconds_count{tenant_id=~\"$tenant_id\",agent_type=~\"$agent_type\"}[5m]))",
            "legendFormat": "{{agent_type}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "custom": {"lineWidth": 2, "fillOpacity": 10}
          }
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {"displayMode": "table", "placement": "bottom"}
        }
      },
      {
        "id": 10,
        "title": "Tool Call Rate by Tool (calls/s)",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 28},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "sum by (tool_name) (rate(tool_calls_total{tenant_id=~\"$tenant_id\"}[5m]))",
            "legendFormat": "{{tool_name}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "reqps",
            "custom": {"lineWidth": 2, "fillOpacity": 10}
          }
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {"displayMode": "table", "placement": "bottom"}
        }
      },
      {
        "id": 11,
        "title": "Tool Success vs Failure Rate (%)",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 28},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "100 * (sum by (tool_name) (rate(tool_calls_total{tenant_id=~\"$tenant_id\",success=\"true\"}[5m])) / sum by (tool_name) (rate(tool_calls_total{tenant_id=~\"$tenant_id\"}[5m])))",
            "legendFormat": "{{tool_name}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "yellow", "value": 90},
                {"color": "green", "value": 99}
              ]
            },
            "custom": {"lineWidth": 2, "fillOpacity": 5}
          }
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {"displayMode": "table", "placement": "bottom"}
        }
      },
      {
        "id": 12,
        "title": "Tool Latency P95 (seconds)",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 36},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum by (le, tool_name) (rate(tool_duration_seconds_bucket{tenant_id=~\"$tenant_id\"}[5m])))",
            "legendFormat": "{{tool_name}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {"lineWidth": 2, "fillOpacity": 5}
          }
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max"]}
        }
      },
      {
        "id": 13,
        "title": "Tool Usage Distribution (last 1 h)",
        "type": "piechart",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 36},
        "datasource": {"type": "prometheus", "uid": "prometheus"},
        "targets": [
          {
            "expr": "sum by (tool_name) (increase(tool_calls_total{tenant_id=~\"$tenant_id\"}[1h]))",
            "legendFormat": "{{tool_name}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {"unit": "short"}
        },
        "options": {
          "pieType": "donut",
          "tooltip": {"mode": "single"},
          "legend": {"displayMode": "table", "placement": "right"}
        }
      }
    ]
  }
}
