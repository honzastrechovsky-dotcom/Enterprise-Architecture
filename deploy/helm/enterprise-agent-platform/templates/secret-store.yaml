{{- if .Values.secrets.useExternalSecret }}
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: {{ .Values.secrets.externalSecret.storeName | default (printf "%s-azure-kv" .Release.Name) }}
  labels:
    {{- include "enterprise-agent-platform.labels" . | nindent 4 }}
spec:
  provider:
    azurekv:
      authType: WorkloadIdentity
      vaultUrl: {{ .Values.secrets.externalSecret.vaultUrl | required "secrets.externalSecret.vaultUrl is required when useExternalSecret is true" | quote }}
      {{- if .Values.secrets.externalSecret.tenantId }}
      tenantId: {{ .Values.secrets.externalSecret.tenantId | quote }}
      {{- end }}
      serviceAccountRef:
        name: {{ .Values.secrets.externalSecret.serviceAccountRef | default "external-secrets-sa" }}
        {{- if .Values.secrets.externalSecret.serviceAccountNamespace }}
        namespace: {{ .Values.secrets.externalSecret.serviceAccountNamespace | quote }}
        {{- end }}
{{- end }}
